# Supabase Integration for Done and Dusted

## âœ… What's Been Set Up

### 1. Database Created
- **Table**: `bookings`
- **Columns** (recommended)
  - `id` (bigint, primary key, identity/auto-increment)
  - `name` (text), `email` (text), `phone` (text)
  - `service` (text), `date` (date), `notes` (text)
  - `status` (text, default `'Pending'`)
  - `cleaner` (text, nullable)
  - `admin_notes` (text, nullable)
  - `whatsapp_confirmed` (boolean, default false)
  - `created_at` (timestamp with time zone, default `now()`)
  - `updated_at` (timestamp with time zone, default `now()`)

> If you already created the table, run the SQL below to add any missing columns so the admin + cleaner dashboards can read/write properly.

```sql
-- Create table (if new)
create table if not exists public.bookings (
  id bigint generated by default as identity primary key,
  name text not null,
  email text not null,
  phone text not null,
  service text not null,
  date date not null,
  notes text,
  status text default 'Pending',
  cleaner text,
  admin_notes text,
  whatsapp_confirmed boolean default false,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

-- Add missing columns safely (run only if needed)
alter table public.bookings add column if not exists cleaner text;
alter table public.bookings add column if not exists admin_notes text;
alter table public.bookings add column if not exists whatsapp_confirmed boolean default false;
alter table public.bookings add column if not exists updated_at timestamptz default now();
alter table public.bookings add column if not exists created_at timestamptz default now();
alter table public.bookings alter column status set default 'Pending';
```

> Optional: add an index to speed up dashboard filters
```sql
create index if not exists idx_bookings_status_service on public.bookings(status, service);
create index if not exists idx_bookings_date on public.bookings(date);
create index if not exists idx_bookings_cleaner on public.bookings(cleaner);
```

### 2. Files Created/Modified
- âœ… `js/supabase-config.js` - Supabase configuration
- âœ… `js/main.js` - Updated to save bookings to Supabase
- âœ… `js/admin.js` - Enhanced with status updates and search

### 3. Next Steps to Complete Integration

#### Step 1: Add Supabase Library to index.html
Add these lines before `</body>` tag in `index.html`:

```html
<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-config.js"></script>
```

Make sure they come BEFORE `<script src="js/main.js"></script>`

#### Step 2: Admin + Cleaner Dashboards
`dashboard.html` (admin) and `cleaner-dashboard.html` now pull data directly from Supabase through `js/admin.js`. The table must include the columns listed above (notably `cleaner`, `admin_notes`, `whatsapp_confirmed`) for status updates, assignments, and WhatsApp flags to work end-to-end.

## ğŸ” Security Note
The API key in `supabase-config.js` is the **anon** (public) key, which is safe to use in frontend code. Row Level Security (RLS) policies protect your data.

- Enable RLS on `public.bookings`.
- Create policies to allow inserts from the public site (unauthenticated) and read/update/delete for authenticated dashboard roles if you add auth later. For now, the dashboards rely on the anon key, so keep policies permissive or wire Supabase Auth/JWT.

## ğŸ“Š How It Works Now

### Customer Booking Flow:
1. Customer fills form on website
2. Data is saved to Supabase database
3. Data is **permanent** and accessible from anywhere

### Admin Flow:
1. Admin logs in at `admin.html`
2. Views all bookings from database
3. Can update status, search, and delete bookings

## ğŸš€ Benefits Over localStorage
- âœ… **Permanent storage** - Data never gets lost
- âœ… **Multi-device access** - View from any computer
- âœ… **Real database** - Professional and scalable
- âœ… **Automatic backups** - Supabase handles it
- âœ… **Secure** - Row Level Security enabled

## ğŸ“ Admin Credentials
- Email: `admin@doneanddusted.co.uk`
- Password: `admin123`

**Remember to change these in production!**
